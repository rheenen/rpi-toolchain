#!/bin/bash

# find base and firmware
export RPITOOLCHAIN_BASE=`readlink -f \`dirname ${BASH_SOURCE}\``
export RPIFIRMWARE="${RPITOOLCHAIN_BASE}/firmware"

# check for softfp
if [ "${1}" == "soft" ] || [ "${1}" == "softfp" ]; then
	echo 'Using softfp toolchain'
	export RPITOOLCHAIN_TARGET="arm-bcm2708-linux-gnueabi"
	shift

# default to hardfp
else
	echo 'Using hardfp toolchain'
	export RPITOOLCHAIN_TARGET="arm-bcm2708hardfp-linux-gnueabi"
	export RPIFIRMWARE="${RPIFIRMWARE}/hardfp"
fi

# build final toolchain path
export RPITOOLCHAIN="${RPITOOLCHAIN_BASE}/tools/arm-bcm2708/${RPITOOLCHAIN_TARGET}"

# generic environment
export CXX=${RPITOOLCHAIN}/bin/${RPITOOLCHAIN_TARGET}-g++
export CC=${RPITOOLCHAIN}/bin/${RPITOOLCHAIN_TARGET}-gcc
export LD=${RPITOOLCHAIN}/bin/${RPITOOLCHAIN_TARGET}-ld
export LD_LIBRARY_PATH=${RPITOOLCHAIN}/${RPITOOLCHAIN_TARGET}/sysroot/lib
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:${RPIFIRMWARE}/opt/vc/lib

# execute
[ "${0}" != "-bash" ]  && [ ${#*} -gt 0 ] && exec ${*:1}

